/*

	jQuery Tags Input Plugin 1.3.3
	
	Copyright (c) 2011 XOXCO, Inc
	
	Documentation for this plugin lives here:
	http://xoxco.com/clickable/jquery-tags-input
	
	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php

	ben@xoxco.com

*/
!function(t){var e=new Array,n=new Array;t.fn.doAutosize=function(e){var n=t(this).data("minwidth"),i=t(this).data("maxwidth"),o="",r=t(this),s=t("#"+t(this).data("tester_id"));if(o!==(o=r.val())){var a=o.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");s.html(a);var l=s.width(),u=l+e.comfortZone>=n?l+e.comfortZone:n,c=r.width(),d=c>u&&u>=n||u>n&&i>u;d&&r.width(u)}},t.fn.resetAutosize=function(e){var n=t(this).data("minwidth")||e.minInputWidth||t(this).width(),i=t(this).data("maxwidth")||e.maxInputWidth||t(this).closest(".tagsinput").width()-e.inputPadding,o=t(this),r=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),letterSpacing:o.css("letterSpacing"),whiteSpace:"nowrap"}),s=t(this).attr("id")+"_autosize_tester";!t("#"+s).length>0&&(r.attr("id",s),r.appendTo("body")),o.data("minwidth",n),o.data("maxwidth",i),o.data("tester_id",s),o.css("width",n)},t.fn.addTag=function(i,o){return o=jQuery.extend({focus:!1,callback:!0},o),this.each(function(){var r=t(this).attr("id"),s=t(this).val().split(e[r]);if(""==s[0]&&(s=new Array),i=jQuery.trim(i),o.unique){var a=t(this).tagExist(i);1==a&&t("#"+r+"_tag").addClass("not_valid")}else var a=!1;if(""!=i&&1!=a){if(t("<span>").addClass("tag").append(t("<span>").text(i).append("&nbsp;&nbsp;"),t('<a class="tagsinput-remove-link">',{href:"#",title:"Remove tag",text:""}).click(function(){return t("#"+r).removeTag(escape(i))})).insertBefore("#"+r+"_addTag"),s.push(i),t("#"+r+"_tag").val(""),o.focus?t("#"+r+"_tag").focus():t("#"+r+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,s),o.callback&&n[r]&&n[r].onAddTag){var l=n[r].onAddTag;l.call(this,i)}if(n[r]&&n[r].onChange){var u=s.length,l=n[r].onChange;l.call(this,t(this),s[u-1])}}}),!1},t.fn.removeTag=function(o){return o=unescape(o),this.each(function(){var r=t(this).attr("id"),s=t(this).val().split(e[r]);for(t("#"+r+"_tagsinput .tag").remove(),str="",i=0;i<s.length;i++)s[i]!=o&&(str=str+e[r]+s[i]);if(t.fn.tagsInput.importTags(this,str),n[r]&&n[r].onRemoveTag){var a=n[r].onRemoveTag;a.call(this,o)}}),!1},t.fn.tagExist=function(n){var i=t(this).attr("id"),o=t(this).val().split(e[i]);return jQuery.inArray(n,o)>=0},t.fn.importTags=function(e){id=t(this).attr("id"),t("#"+id+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,e)},t.fn.tagsInput=function(i){var o=jQuery.extend({interactive:!0,defaultText:"",minChars:0,width:"",height:"",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i);return this.each(function(){o.hide&&t(this).hide();var i=t(this).attr("id");(!i||e[t(this).attr("id")])&&(i=t(this).attr("id","tags"+(new Date).getTime()).attr("id"));var r=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},o);e[i]=r.delimiter,(o.onAddTag||o.onRemoveTag||o.onChange)&&(n[i]=new Array,n[i].onAddTag=o.onAddTag,n[i].onRemoveTag=o.onRemoveTag,n[i].onChange=o.onChange);var s=t("#"+i).attr("class").replace("tagsinput",""),a='<div id="'+i+'_tagsinput" class="tagsinput '+s+'"><div class="tagsinput-add-container" id="'+i+'_addTag"><div class="tagsinput-add"></div>';if(o.interactive&&(a=a+'<input id="'+i+'_tag" value="" data-default="'+o.defaultText+'" />'),a+="</div></div>",t(a).insertAfter(this),t(r.holder).css("width",o.width),t(r.holder).css("min-height",o.height),t(r.holder).css("height","100%"),""!=t(r.real_input).val()&&t.fn.tagsInput.importTags(t(r.real_input),t(r.real_input).val()),o.interactive){if(t(r.fake_input).val(t(r.fake_input).attr("data-default")),t(r.fake_input).css("color",o.placeholderColor),t(r.fake_input).resetAutosize(o),t(r.holder).bind("click",r,function(e){t(e.data.fake_input).focus()}),t(r.fake_input).bind("focus",r,function(e){t(e.data.fake_input).val()==t(e.data.fake_input).attr("data-default")&&t(e.data.fake_input).val(""),t(e.data.fake_input).css("color","#000000")}),void 0!=o.autocomplete_url){autocomplete_options={source:o.autocomplete_url};for(attrname in o.autocomplete)autocomplete_options[attrname]=o.autocomplete[attrname];void 0!==jQuery.Autocompleter?(t(r.fake_input).autocomplete(o.autocomplete_url,o.autocomplete),t(r.fake_input).bind("result",r,function(e,n){n&&t("#"+i).addTag(n[0]+"",{focus:!0,unique:o.unique})})):void 0!==jQuery.ui.autocomplete&&(t(r.fake_input).autocomplete(autocomplete_options),t(r.fake_input).bind("autocompleteselect",r,function(e,n){return t(e.data.real_input).addTag(n.item.value,{focus:!0,unique:o.unique}),!1}))}else t(r.fake_input).bind("blur",r,function(e){var n=t(this).attr("data-default");return""!=t(e.data.fake_input).val()&&t(e.data.fake_input).val()!=n?e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:o.unique}):(t(e.data.fake_input).val(t(e.data.fake_input).attr("data-default")),t(e.data.fake_input).css("color",o.placeholderColor)),!1});t(r.fake_input).bind("keypress",r,function(e){return e.which==e.data.delimiter.charCodeAt(0)||13==e.which?(e.preventDefault(),e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:o.unique}),t(e.data.fake_input).resetAutosize(o),!1):(e.data.autosize&&t(e.data.fake_input).doAutosize(o),void 0)}),r.removeWithBackspace&&t(r.fake_input).bind("keydown",function(e){if(8==e.keyCode&&""==t(this).val()){e.preventDefault();var n=t(this).closest(".tagsinput").find(".tag:last").text(),i=t(this).attr("id").replace(/_tag$/,"");n=n.replace(/[\s\u00a0]+x$/,""),t("#"+i).removeTag(escape(n)),t(this).trigger("focus")}}),t(r.fake_input).blur(),r.unique&&t(r.fake_input).keydown(function(e){(8==e.keyCode||String.fromCharCode(e.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&t(this).removeClass("not_valid")})}}),this},t.fn.tagsInput.updateTagsField=function(n,i){var o=t(n).attr("id");t(n).val(i.join(e[o]))},t.fn.tagsInput.importTags=function(o,r){t(o).val("");var s=t(o).attr("id"),a=r.split(e[s]);for(i=0;i<a.length;i++)t(o).addTag(a[i],{focus:!1,callback:!1});if(n[s]&&n[s].onChange){var l=n[s].onChange;l.call(o,o,a[i])}}}(jQuery);